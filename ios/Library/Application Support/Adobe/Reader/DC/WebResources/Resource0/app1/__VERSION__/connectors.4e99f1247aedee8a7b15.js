"use strict";(self["webpackJsonp-dc-desktop-app"]=self["webpackJsonp-dc-desktop-app"]||[]).push([[617],{zSbg:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s("plsW"),o=s("Lk87");const a=new class BaseURIModel{constructor(){this._baseFilesURIs={api:"https://files.acrobat.com/api/aax/",cloud_do_not_use:"https://cloud.acrobat.com/",commenting_uri:"https://comments.adobe.io/",download:"https://files-download2.acrocomcontent.com/api/ddx/",ims:"https://ims-na1.adobelogin.com/",prefs:"https://cloud.acrobat.com/api/aax/",rendition:"https://files.acrobat.com/api/rrx/",send_api:"https://send.acrobat.com/a/api/",ui_helpers:"https://cloud.acrobat.com/api/aax/",upload:"https://upload2.files.acrobat.com/api/uux/",users:"https://cloud.acrobat.com/api/aax/"},this._isBaseFilesURISet=!1,this._baseCreatePdfURIs={api:"https://createpdf.acrobat.com/createpdf/api/",users:"https://createpdf.acrobat.com/createpdf/api/",prefs:"https://createpdf.acrobat.com/createpdf/api/",ims:"https://ims-na1.adobelogin.com/",blueheron:"https://files.acrobat.com/",ipmcontext:"https://createpdf.acrobat.com/createpdf/api/users/me/ipm_context"},this._isBaseCreatePdfURISet=!1,this._durableLinkBaseURI="https://acrobat.adobe.com/id/",this._isDurableLinkBaseURISet=!1,this._invitationBaseURI="https://invitations.adobe.io/api/v4"}get isBaseFilesURISet(){return this._isBaseFilesURISet}get isBaseCreatePdfURISet(){return this._isBaseCreatePdfURISet}get isDurableLinkBaseURISet(){return this._isDurableLinkBaseURISet}async getBaseFilesURIs(){const e=new o.Z;try{if(!this.isBaseFilesURISet){const e=await i.providers["native-api"](),t=await e.ResponseCacheAPI(),s=await t.GetBaseURIs("Files");null!=s&&(this._baseFilesURIs.api=null!=s.api&&""!=s.api?s.api:this._baseFilesURIs.api,this._baseFilesURIs.cloud_do_not_use=null!=s.cloud_do_not_use&&""!=s.cloud_do_not_use?s.cloud_do_not_use:this._baseFilesURIs.cloud_do_not_use,this._baseFilesURIs.commenting_uri=null!=s.commenting_uri&&""!=s.commenting_uri?s.commenting_uri:this._baseFilesURIs.commenting_uri,this._baseFilesURIs.download=null!=s.download&&""!=s.download?s.download:this._baseFilesURIs.download,this._baseFilesURIs.ims=null!=s.ims&&""!=s.ims?s.ims:this._baseFilesURIs.ims,this._baseFilesURIs.prefs=null!=s.prefs&&""!=s.prefs?s.prefs:this._baseFilesURIs.prefs,this._baseFilesURIs.rendition=null!=s.rendition&&""!=s.rendition?s.rendition:this._baseFilesURIs.rendition,this._baseFilesURIs.send_api=null!=s.send_api&&""!=s.send_api?s.send_api:this._baseFilesURIs.send_api,this._baseFilesURIs.ui_helpers=null!=s.ui_helpers&&""!=s.ui_helpers?s.ui_helpers:this._baseFilesURIs.ui_helpers,this._baseFilesURIs.upload=null!=s.upload&&""!=s.upload?s.upload:this._baseFilesURIs.upload,this._baseFilesURIs.users=null!=s.users&&""!=s.users?s.users:this._baseFilesURIs.users),this._isBaseFilesURISet=!0}e.resolve(this._baseFilesURIs)}catch(t){e.resolve(this._baseFilesURIs)}return e.promise}async getBaseCreatePdfURIs(){const e=new o.Z;try{if(!this.isBaseCreatePdfURISet){const e=await i.providers["native-api"](),t=await e.ResponseCacheAPI(),s=await t.GetBaseURIs("CreatePDF");null!=s&&(this._baseCreatePdfURIs.api=null!=s.api&&""!=s.api?s.api:this._baseCreatePdfURIs.api,this._baseCreatePdfURIs.users=null!=s.users&&""!=s.users?s.users:this._baseCreatePdfURIs.users,this._baseCreatePdfURIs.ims=null!=s.ims&&""!=s.ims?s.ims:this._baseCreatePdfURIs.ims,this._baseCreatePdfURIs.prefs=null!=s.prefs&&""!=s.prefs?s.prefs:this._baseCreatePdfURIs.prefs,this._baseCreatePdfURIs.blueheron=null!=s.blueheron&&""!=s.blueheron?s.blueheron:this._baseCreatePdfURIs.blueheron,this._baseCreatePdfURIs.ipmcontext=null!=s.ipmcontext&&""!=s.ipmcontext?s.ipmcontext:this._baseCreatePdfURIs.ipmcontext),this._isBaseCreatePdfURISet=!0}e.resolve(this._baseCreatePdfURIs)}catch(t){e.resolve(this._baseCreatePdfURIs)}return e.promise}async getDurableLinkBaseURI(){const e=new o.Z;try{if(!this.isDurableLinkBaseURISet){const e=await i.providers["native-api"](),t=await e.UnifiedSharePopupAPI(),s=await t.GetDurableLinkBaseURIFromDiscoveryResponse();this._durableLinkBaseURI=null!=s&&""!=s?s:this._durableLinkBaseURI}}catch(e){}return e.resolve(this._durableLinkBaseURI),e.promise}async getInvitationBaseURI(){const e=new o.Z;try{const e=await i.providers["native-api"](),t=await e.UnifiedSharePopupAPI(),s=await t.GetInvitationBaseURIFromDiscoveryResponse();this._invitationBaseURI=null!=s&&""!=s?s:this._invitationBaseURI}catch(e){}return e.resolve(this._invitationBaseURI),e.promise}}},"c1/L":(e,t,s)=>{s.r(t),s.d(t,{default:()=>ConnectorsProvider});var i=s("plsW"),o=s("/fmr"),a=s("A34E"),n=s("Lk87"),r=s("n0Zc");class CachedFileInfo{constructor(e){var t;this.name=e.name,this.size=e.size,e.dateAdded?this.date=Math.round(e.dateAdded.getTime()/1e3).toString():e.dateModified&&(this.date=Math.round((null===(t=e.dateModified)||void 0===t?void 0:t.getTime())/1e3).toString()),this.id=e.id.toString(),this.type=e.type}}class CachedFolderInfo{constructor(e){this.name=e.name,this.id=e.id.toString(),this.type=e.type}}class FileListCacheKey{constructor(e,t,s){this.connector=e,this.accountId=t,this.folderId=s}}class FileListCacheValue{constructor(e){this.sortBy="name",this.sortDirection="ascending",this.savedAt="",this.ttl=3600,this.assetList=e}isStale(){return Date.now()/1e3>parseInt(this.savedAt,10)+this.ttl}}class PersistentFileListCache{constructor(){this.mCache=new Map}static GetInstance(){return PersistentFileListCache.instance||(PersistentFileListCache.instance=new PersistentFileListCache),PersistentFileListCache.instance}static async Add(e,t){const s=await r.default.getInstance(),i=await s.connectorsAPI();t.savedAt=Math.round(Date.now()/1e3).toString(),i.addToFileListCache(e,t)}static async Get(e){const t=await r.default.getInstance(),s=await t.connectorsAPI(),i=await s.getFileListFromCache(e);if(i&&i.assetList){const e=new FileListCacheValue(i.assetList);if(e.sortBy=null==i?void 0:i.sortBy,e.sortDirection=null==i?void 0:i.sortDirection,e.savedAt=null==i?void 0:i.savedAt,e.ttl=null==i?void 0:i.ttl,e.isStale())return;return e}}}var c=s("zSbg");class DCFolderInfo{get id(){return this.folderID}constructor(e,t){this.type=o.h.FOLDER,this.name="",this.folderID="",this.name=e,this.folderID=t}}class DCFileInfo{get id(){return this.assetID}constructor(e){this.type=a.Z.getAssetTypeFromMimeType(e.type),this.name=e.name,this.size=e.size,this.dateAdded=new Date(e.created),this.assetID=e.asset_id,this.isShared=e.isShared||!1}}class DCFileListPage{constructor(e,t){this.members=[],this.pageNum=e,this.pageUri=t}}class DCFileListProvider{constructor(){this.mFileListCache={},this.CacheFileListForFolder=this.CacheFileListForFolder.bind(this),this.CacheRootFolder=this.CacheRootFolder.bind(this)}async GetRootFolder(){if(this.mRootFolder)return this.mRootFolder;const e=await i.providers["dc-discovery"](),t=(await e.GetDCDiscoveryReponse()).resources.folders.get_root,s=await e.GetHTTPHeaders(t.accept["root_v1.json"]),o=(await i.providers["network-api"]()).GetNetworkQuery(t.uri,{},{method:t.http_method,headers:s},{staleTime:36e5}),a=new n.Z,r={onResponse:e=>{this.mRootFolder=new DCFolderInfo("/",e.folder_id),a.resolve(this.mRootFolder),setTimeout((()=>{this.CacheRootFolder(this.mRootFolder)}),0)},onStatusChange:e=>{},onError:e=>{a.reject(e)}};return o.Subscribe(r),o.Refresh(),a.promise}CacheRootFolder(e){const t=new FileListCacheKey("dc","dc","root"),s=new FileListCacheValue([new CachedFolderInfo(e)]);PersistentFileListCache.Add(t,s)}CreateFileListUriParams(e){const t={page_size:20};if(e){let s="";switch(e.column){case o.z.name:s="name";break;case o.z.type:s="extension";break;case o.z.size:s="size";break;case o.z.date:s="created"}""!==s&&(t.order_by=s,t.sort_order=e.direction?e.direction:"ascending")}return t}async GetFileList(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!(e instanceof DCFolderInfo))return[];const o=e.folderID;this.mActiveSortDescriptor=s;let a="";do{if(!(o in this.mFileListCache))break;const e=this.mFileListCache[o].get(s);if(!e)break;if(t>=e.length)break;if(e[t].members.length>0)return e;if(""!==e[t].pageUri){a=e[t].pageUri;break}}while(0);if(0!==t&&0===a.length)return[];if(!this.mAllowedFileExtns){const e=await r.default.getInstance(),t=await e.fileAPI();this.mAllowedFileExtns=t.getAllowedFileExtensions()}const c=await i.providers["dc-discovery"](),l=(await c.GetDCDiscoveryReponse()).resources.folders.list,d=await c.GetHTTPHeaders(l.accept["folder_listing_v1.json"]);0===a.length&&(a=c.ParseDiscoveryUriToFullUri(l.uri,{folder_id:o},this.CreateFileListUriParams(s)),o in this.mFileListCache||(this.mFileListCache[o]=new Map),this.mFileListCache[o].set(s,[new DCFileListPage(t,a)]));const h=(await i.providers["network-api"]()).GetNetworkQuery(a,{},{method:l.http_method,headers:d}),u=new n.Z,m={onResponse:i=>{var a,n;h.Unsubscribe(m);const r=null===(a=this.mFileListCache[o])||void 0===a?void 0:a.get(s);r?(r[t].members=this.ProcessFileList(i.members),"next_page_uri"in i._pages&&(r[t+1]=new DCFileListPage(t+1,i._pages.next_page_uri)),u.resolve(r),(null===(n=this.mRootFolder)||void 0===n?void 0:n.folderID)===e.folderID&&setTimeout((()=>{this.CacheFileListForFolder(e)}),0)):u.reject("File list cache does not exist")},onStatusChange:e=>{},onError:e=>{h.Unsubscribe(m),u.reject(e)}};return h.Subscribe(m),h.Refresh(),u.promise}ProcessFileList(e){return e.map((e=>"folder"===e.object_type?new DCFolderInfo(e.name,e.folder_id):new DCFileInfo(e)))}async SaveFile(e,t,s,o,a,n,r){if(!(e instanceof DCFolderInfo))return;if("string"==typeof t){if(0===t.length)return}else if(!(t instanceof DCFileInfo))return;const c={saveAsParentFolderid:e.folderID,closeWindow:!0};"string"==typeof t?c.saveAsFilename=this.SanitizeFileName(t):(c.saveAsFilename=t.name,c.selectedBHFiles=[{id:t.assetID,name:t.name}]),"boolean"==typeof s&&(c.reduceFileSize=s),"boolean"==typeof o&&(c.isExportButtonSelected=o),"string"==typeof a&&(c.outputFormatFromSaveAs=a),"string"==typeof n&&(c.fileSaveAsSelectedPluginId=n);const l=await i.providers["native-api"](),d=await l.fileAPI();d.setFileAncestor([e.folderID],1),d.setSelectedFilesData(c),setTimeout((()=>{this.CacheFileListForFolder(e)}),1)}async GetFileListFromCache(e,t){if(!(e instanceof DCFolderInfo))return;const s=new FileListCacheKey("dc","dc",e.folderID),i=await PersistentFileListCache.Get(s);if(i&&i.assetList.length>0){const e=new DCFileListPage(0,""),s=i.assetList.map((e=>{var t;if(e.type===o.h.FOLDER){const t=e;return new DCFolderInfo(t.name,t.id.toString())}const s=e,i=new DCFileInfo({name:s.name,size:s.size,asset_id:null===(t=s.id)||void 0===t?void 0:t.toString()});return i.type=s.type,s.date&&(i.dateAdded=new Date(1e3*parseInt(s.date,10))),i})),a=t.column?t.column:o.z.name,n="descending"===(t.direction?t.direction:"ascending")?-1:1;return s.sort(((e,t)=>{const s=e.type===o.h.FOLDER,i=t.type===o.h.FOLDER;if(s!==i)return s?-1:1;if(s&&i){return e.name.toLocaleLowerCase()<t.name.toLocaleLowerCase()?-1:1}if(a===o.z.name){const s=e.name.toLocaleLowerCase(),i=t.name.toLocaleLowerCase();return n*(s<i?-1:1)}return 0})),e.members=s,[e]}}async GetRootFolderFromCache(){const e=new FileListCacheKey("dc","dc","root"),t=await PersistentFileListCache.Get(e);if(t&&1===t.assetList.length){const e=t.assetList[0];return new DCFolderInfo(e.name,e.id.toString())}}async CacheFileListForFolder(e){if(!(e instanceof DCFolderInfo))return;if(!this.mActiveSortDescriptor)return;const t=e.folderID;let s=[];const i=this.mFileListCache[t].get(this.mActiveSortDescriptor);if(!i)return;i.forEach((e=>{s=s.concat(e.members)}));const a=s.map((e=>e.type===o.h.FOLDER?new CachedFolderInfo(e):new CachedFileInfo(e))),n=new FileListCacheKey("dc","dc",t),r=new FileListCacheValue(a);r.sortBy=this.mActiveSortDescriptor.column?this.mActiveSortDescriptor.column.toString():o.z.name,r.sortDirection=this.mActiveSortDescriptor.direction?this.mActiveSortDescriptor.direction:"ascending",PersistentFileListCache.Add(n,r)}async FindFileWithName(e,t){if(e&&t&&t instanceof DCFolderInfo)return e=this.SanitizeFileName(e),this.GetExistingFileInFolder(e,t)}SanitizeFileName(e){if(""===e)return e;let t=e.normalize("NFC");const s=a.Z.getExtension(t),i=this.mAllowedFileExtns;return i&&i.size>0&&(s&&i.has(s.toLowerCase())||(t+=[...i][0])),t}IsACPUser(e){return e.templates.search_uri_primary&&"{+search_uri_v2}"===e.templates.search_uri_primary}async GetSearchRequestURI(e){return this.IsACPUser(e)?e.templates.search_uri_v2:e.templates.search_uri}async GetSearchRequestBody(e,t,s){const i=s,o=this.IsACPUser(e);let a={q:t,container:{asset_id:[i.folderID]},parent_id:[i.folderID],limit:1,sort_orderby:"asset_name",sort_order:"asc"};return a=o?Object.assign(a,{scope:["creative_cloud"],op_none_of:[{"api:metadata/application$$shell:visibility":["hiddenSelf","hiddenRecursive"]},{"app_metadata$$project:directoryType":"team"},{op_field_exists:["app_metadata$$cc:inherited$$cc:team"]}],creative_cloud_asset_type:["asset","collection"],creative_cloud_toplevel_collection_name:"cloud-content",start_index:0,asset_id_opacity:!0}):Object.assign(a,{scope:["document_cloud"],subScope:"document_cloud"}),a}async GetExistingFileInFolder(e,t){if(!(t.folderID in this.mFileListCache))return;const s=e.toLocaleLowerCase(),o=await i.providers["dc-discovery"](),a=await o.GetDCDiscoveryReponse(),r=await this.GetSearchRequestURI(a),c=await o.GetUSSHTTPHeaders(),l=await this.GetSearchRequestBody(a,s,t),d=(await i.providers["network-api"]()).GetNetworkMutation(r,{},{method:"POST",headers:c}),h=new n.Z,u={onResponse:e=>{d.Unsubscribe(u),console.log({responseData:e});const t=e;if(t.metrics&&t.result_sets&&t.metrics.total_hits>0&&t.result_sets.length>0&&t.result_sets[0].items&&t.result_sets[0].items.length>0){const e=t.result_sets[0].items[0];if(e.asset_name&&e.asset_name.toLocaleLowerCase()===s){let t=!1;return e.custom_document_cloud_metadata&&e.custom_document_cloud_metadata.is_shared&&(t=e.custom_document_cloud_metadata.is_shared),e.collab_metadata&&e.collab_metadata.shared_by&&e.collab_metadata.shared_by.length>0&&(t=!0),void h.resolve(new DCFileInfo({name:e.asset_name,asset_id:e.asset_id,type:e.type,size:e.size,created:e.create_date,isShared:t}))}}h.resolve(void 0)},onStatusChange:e=>{},onError:e=>{console.error({errorData:e}),d.Unsubscribe(u),h.reject(e)}};return d.Subscribe(u),d.Mutate(l),h.promise}async CreateFolder(e,t){if(!(e instanceof DCFolderInfo))return[];const s=e.folderID,o=await i.providers["dc-discovery"](),a=await o.GetDCDiscoveryReponse(),r=a.resources.folders.create,c=await o.GetHTTPHeaders(r.accept["folder_v1.json"],r.content_type["folder_creation_v1.json"]),l={name:t,parent_uri:o.ParseDiscoveryUriToFullUri(a.templates.folder_uri,{folder_id:s},{}),on_dup_name:"error"},d=(await i.providers["network-api"]()).GetNetworkMutation(r.uri,{},{method:r.http_method,headers:c},{retries:0}),h=new n.Z,u={onResponse:e=>{void 0!==e.uri&&this.mFileListCache[s].clear(),h.resolve(e),d.Unsubscribe(u)},onStatusChange:e=>{},onError:e=>{h.reject(e),d.Unsubscribe(u)}};return d.Subscribe(u),d.Mutate(l),h.promise}async getBreadcrumbs(e){const t=await i.providers["dc-discovery"](),s=(await t.GetDCDiscoveryReponse()).resources.folders.breadcrumbs,o=await t.GetHTTPHeaders(s.accept["folder_breadcrumbs_v1.json"]),a=t.ParseDiscoveryUriToFullUri(s.uri,{folder_id:e},{}),r=(await i.providers["network-api"]()).GetNetworkQuery(a,{},{method:s.http_method,headers:o}),c=new n.Z,l={onResponse:e=>{if(r.Unsubscribe(l),!e)return void c.reject("Response data is empty");const t=null==e?void 0:e.breadcrumbs,s=[];null==t||t.forEach((e=>{let t=e.uri.split("/");t=t[t.length-1],s.push(new DCFolderInfo(e.name,t))})),c.resolve(s)},onStatusChange:e=>{},onError:e=>{r.Unsubscribe(l),c.reject(e)}};return r.Subscribe(l),r.Refresh(),c.promise}async GetBreadcrumbsForCurrentFSD(){const e=await r.default.getInstance(),t=await e.fileAPI(),s=await t.getFileAncestors();return void 0!==s&&s.length>0?await this.getBreadcrumbs(s):[]}async ValidateAssetName(e){const t=await i.providers["dc-discovery"](),s=await i.providers["native-api"](),o=await s.SessionAPI(),a=(await c.Z.getBaseFilesURIs()).api+"name_validator?x-api-client-id="+o.xApiClientId,r=await t.GetNameValidatorHTTPHeaders(),l={name:e},d=(await i.providers["network-api"]()).GetNetworkMutation(a,{},{method:"POST",headers:r},{retries:0}),h=new n.Z,u={onResponse:e=>{e&&(e.status>=300||e.status<=200)?h.resolve(!1):h.resolve(!0),d.Unsubscribe(u)},onStatusChange:e=>{},onError:e=>{h.resolve(!1),d.Unsubscribe(u)}};return d.Subscribe(u),d.Mutate(l),h.promise}}var l=s("pU5Y");class ConnectorFolderInfo extends l.Z{constructor(){super(...arguments),this.id="",this.name="",this.type=o.h.FOLDER}setName(e){this.name=e}setId(e){this.id=e}}class ConnectorFileInfo extends l.Z{constructor(){super(...arguments),this.id="",this.type=o.h.OTHER,this.name="",this.size=0}setName(e){this.name=e}setId(e){this.id=e}setModifiedDate(e){this.dateModified=e}setType(e){this.type=e}setSize(e){this.size=e}}class ConnectorFileListPage{constructor(){this.pageNum=0,this.members=[]}}class ConnectorFileListAttributes{constructor(){this.sortBy="none",this.sortDirection="assending",this.supportedExtns=["pdf"],this.pageSize=1e3}}class ConnectorFilesProvider{constructor(e,t){this.viewMode="saveAs",this.mFileListCache=new Map,this.connectorName=e,this.accountId=t}ClearCache(){this.mFileListCache.size&&this.mFileListCache.clear()}async GetRootFolder(){if(this.mRootFolder)return this.mRootFolder;const e=await r.default.getInstance(),t=await e.connectorsAPI(),s=(await t.getRootFolder(this.connectorName,this.accountId)).data,i=new ConnectorFolderInfo({proxy:s});return i.createContext(),this.mRootFolder=i,this.mRootFolder.setName("/"),this.mRootFolder}async SortConnectorFileList(e,t){const s=t.column?t.column:o.z.name,i="descending"===(t.direction?t.direction:"ascending")?-1:1;null==e||e.members.sort(((e,t)=>{const n=e.type===o.h.FOLDER,r=t.type===o.h.FOLDER;if(n!==r)return n?-1:1;if(n&&r){const s=e.name.toLocaleLowerCase(),o=t.name.toLocaleLowerCase();return i*(s<o?-1:1)}if(s===o.z.name){const s=e.name.toLocaleLowerCase(),o=t.name.toLocaleLowerCase();return i*(s<o?-1:1)}if(s===o.z.type){const s=e.name.toLocaleLowerCase(),o=t.name.toLocaleLowerCase(),n=a.Z.getExtension(s)||"",r=a.Z.getExtension(o)||"";return i*(n<r?-1:1)}const c=e,l=t;if(c&&l){if(s===o.z.size){const e=c.size<l.size?-1:1;return i*e}if(c.dateModified&&l.dateModified&&s===o.z.date){const e=c.dateModified.getTime()<l.dateModified.getTime()?-1:1;return i*e}}return 0}))}async GetFileList(e,t,s,i){var o;if(!(e instanceof ConnectorFolderInfo))return[];const a=[];if(this.mFileListCache.has(e)){const t=null===(o=this.mFileListCache.get(e))||void 0===o?void 0:o.pop();t&&(this.SortConnectorFileList(t,s),a.push(t)),this.mFileListCache.set(e,a)}else{const t=new ConnectorFileListAttributes,i=await this.FetchFileListDataForFolder(e,t),o=new ConnectorFileListPage;if(!this.mAllowedFileExtns){const e=await r.default.getInstance(),t=await e.fileAPI();this.mAllowedFileExtns=t.getAllowedFileExtensions()}const n=await this.ParseFilesData(i);o.members=o.members.concat(n),this.SortConnectorFileList(o,s),a.push(o),this.mFileListCache.set(e,a)}return this.mFileListCache.get(e)}async SaveFile(e,t,s,o,a,n,r){if(!(e instanceof ConnectorFolderInfo))return;if("string"==typeof t){if(0===t.length)return}else if(!(t instanceof ConnectorFileInfo))return;const c={saveAsParentFolderObject:e.getProxy(),closeWindow:!0};if("string"==typeof t){c.saveAsFilename=this.SanitizeFileName(t);const s=this.GetExistingFileInFolder(c.saveAsFilename,e);s&&(c.selectedFileObjects=[s.getProxy()],c.saveAsFilename=s.name)}else c.selectedFileObjects=[t.getProxy()],c.saveAsFilename=t.name;"boolean"==typeof s&&(c.reduceFileSize=s),"boolean"==typeof o&&(c.isExportButtonSelected=o),"string"==typeof a&&(c.outputFormatFromSaveAs=a),"string"==typeof n&&(c.fileSaveAsSelectedPluginId=n);const l=await i.providers["native-api"](),d=await l.fileAPI();if(r&&r.length>0){let e=[];r.forEach((t=>{e.push(t.getProxyId())})),d.setFileAncestor(e,0)}d.setSelectedFilesData(c)}async FindFileWithName(e,t){if(e&&t&&t instanceof ConnectorFolderInfo)return e=this.SanitizeFileName(e),this.GetExistingFileInFolder(e,t)}SanitizeFileName(e){if(""===e)return e;let t=e.normalize("NFC");const s=a.Z.getExtension(t),i=this.mAllowedFileExtns;return i&&i.size>0&&(s&&i.has(s.toLowerCase())||(t+=[...i][0])),t}GetExistingFileInFolder(e,t){const s=t;if(!this.mFileListCache.has(s))return;const i=e.toLowerCase(),a=this.mFileListCache.get(s);let n;return a&&a.some((e=>{const t=e.members.find((e=>e.type!==o.h.FOLDER&&e.name.toLowerCase()===i));return!!t&&(n=t,!0)})),n||void 0}async CreateFolder(e,t){return console.error("Operation not supported."),{}}async FetchFileListDataForFolder(e,t){const s=await r.default.getInstance(),i=await s.connectorsAPI(),o=e;return(await i.getFilesForFolder(this.accountId,o.getProxy(),t,this.connectorName,!0)).data.folderItems}async GetRootFolderFromCache(){}async GetFileListFromCache(e,t){}async ParseFilesData(e){const t=[];for(const s of e){let e=!0;let i;if("folder"===s.object_type._value)i=new ConnectorFolderInfo({proxy:s}),i.createContext(),i.setName(i.get("name"));else{i=new ConnectorFileInfo({proxy:s}),i.createContext();const t=i.get("name");e=this.ShouldShowFile(t),e&&(i.setName(t),this.SetFileProperties(i))}e&&(i.setId(i.getProxy()._id.toString()),t.push(i))}return t}ShouldShowFile(e){const t=a.Z.getExtension(e);return!!t&&!(this.mAllowedFileExtns&&!this.mAllowedFileExtns.has(t))}SetFileProperties(e){e.setModifiedDate(new Date(e.get("modified")));let t=o.h.OTHER;const s=e.get("content_type");if(s)t=a.Z.getAssetTypeFromMimeType(s);else{let s=e.get("ext");s||(s=a.Z.getExtension(e.get("name"))),s&&(t=a.Z.getAssetTypeForFileExt(s))}e.setType(t),e.setSize(e.get("size"))}async GetBreadcrumbsForCurrentFSD(){const e=await r.default.getInstance(),t=await e.fileAPI(),s=await t.getFileAncestors(),i=[];return void 0!==s&&s.length>0&&s.forEach(((e,t)=>{const s=new ConnectorFolderInfo({proxy:e});s.createContext(),0===t?s.setName("/"):s.setName(s.get("name")),i.push(s)})),i}async ValidateAssetName(e){const t=await r.default.getInstance(),s=await t.connectorsAPI();try{const t=await s.isFileNameValid(this.connectorName,e);return!(!t.data||!0!==t.data)}catch(e){return!1}}}class ConnectorPaginatedFileListProvider_ConnectorFolderInfo extends l.Z{constructor(){super(...arguments),this.id="",this.name="",this.type=o.h.FOLDER}setName(e){this.name=e}setId(e){this.id=e}}class ConnectorPaginatedFileListProvider_ConnectorFileInfo extends l.Z{constructor(){super(...arguments),this.id="",this.type=o.h.OTHER,this.name="",this.size=0}setName(e){this.name=e}setId(e){this.id=e}setModifiedDate(e){this.dateModified=e}setType(e){this.type=e}setSize(e){this.size=e}}class ConnectorPaginatedFileListProvider_ConnectorFileListPage{constructor(e,t){this.members=[],this.pageNum=e,this.nextPage=t}}class ConnectorPaginatedFileListProvider_ConnectorFileListAttributes{constructor(){this.sortBy="none",this.sortDirection="assending",this.supportedExtns=["pdf"],this.pageSize=1e3}}class ConnectorPaginatedFilesProvider{constructor(e,t){this.viewMode="saveAs",this.mFileListCache={},this.connectorName=e,this.accountId=t}async GetRootFolder(){if(this.mRootFolder)return this.mRootFolder;const e=await r.default.getInstance(),t=await e.connectorsAPI(),s=(await t.getRootFolder(this.connectorName,this.accountId)).data,i=new ConnectorPaginatedFileListProvider_ConnectorFolderInfo({proxy:s});return i.createContext(),this.mRootFolder=i,this.mRootFolder.setName("/"),this.mRootFolder}async SortConnectorFileList(e,t){const s=t.column?t.column:o.z.name,i="descending"===(t.direction?t.direction:"ascending")?-1:1;null==e||e.members.sort(((e,t)=>{const n=e.type===o.h.FOLDER,r=t.type===o.h.FOLDER;if(n!==r)return n?-1:1;if(n&&r){const s=e.name.toLocaleLowerCase(),o=t.name.toLocaleLowerCase();return i*(s<o?-1:1)}if(s===o.z.name){const s=e.name.toLocaleLowerCase(),o=t.name.toLocaleLowerCase();return i*(s<o?-1:1)}if(s===o.z.type){const s=e.name.toLocaleLowerCase(),o=t.name.toLocaleLowerCase(),n=a.Z.getExtension(s)||"",r=a.Z.getExtension(o)||"";return i*(n<r?-1:1)}const c=e,l=t;if(c&&l){if(s===o.z.size){const e=c.size<l.size?-1:1;return i*e}if(c.dateModified&&l.dateModified&&s===o.z.date){const e=c.dateModified.getTime()<l.dateModified.getTime()?-1:1;return i*e}}return 0}))}async GetFileList(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!(e instanceof ConnectorPaginatedFileListProvider_ConnectorFolderInfo))return[];const o=e.name+e.id;do{if(!(o in this.mFileListCache))break;const e=this.mFileListCache[o].get(s);if(!e)break;if(t>=e.length)break;if(e[t].members.length>0)return e;if(e[t].nextPage)break}while(0);let a=[];o in this.mFileListCache&&this.mFileListCache[o].has(s)&&(a=this.mFileListCache[o].get(s));const n=new ConnectorPaginatedFileListProvider_ConnectorFileListAttributes;"onedrive"!==this.connectorName&&"onedrivebusiness"!==this.connectorName||i?"type"===s.column?n.sortBy="none":"onedrivebusiness"!==this.connectorName||"size"!==s.column&&"date"!==s.column?(n.sortBy=s.column?s.column.toString():n.sortBy,n.sortDirection=s.direction?s.direction:n.sortDirection):n.sortBy="none":n.sortBy="none";let c=!0;0!=t&&(c=!1);const l=await this.FetchFileListDataForFolder(e,n,c),d=new ConnectorPaginatedFileListProvider_ConnectorFileListPage(t,!1);if(!this.mAllowedFileExtns){const e=await r.default.getInstance(),t=await e.fileAPI();this.mAllowedFileExtns=t.getAllowedFileExtensions()}const h=await this.ParseFilesData(l.fileListPage);d.members=h;const u=l.hasNextPage;return"none"==n.sortBy&&this.SortConnectorFileList(d,s),a[t]?a[t].members=d.members:a.push(d),u&&(a[t+1]=new ConnectorPaginatedFileListProvider_ConnectorFileListPage(t+1,u),a[t+1].members=[]),o in this.mFileListCache||(this.mFileListCache[o]=new Map),this.mFileListCache[o].set(s,a),this.mFileListCache[o].get(s)}async SaveFile(e,t,s,o,a,n,r){if(!(e instanceof ConnectorPaginatedFileListProvider_ConnectorFolderInfo))return;if("string"==typeof t){if(0===t.length)return}else if(!(t instanceof ConnectorPaginatedFileListProvider_ConnectorFileInfo))return;const c={saveAsParentFolderObject:e.getProxy(),closeWindow:!0};if("string"==typeof t){c.saveAsFilename=this.SanitizeFileName(t);const s=this.GetExistingFileInFolder(c.saveAsFilename,e);s&&(c.selectedFileObjects=[s.getProxy()],c.saveAsFilename=s.name)}else c.selectedFileObjects=[t.getProxy()],c.saveAsFilename=t.name;"boolean"==typeof s&&(c.reduceFileSize=s),"boolean"==typeof o&&(c.isExportButtonSelected=o),"string"==typeof a&&(c.outputFormatFromSaveAs=a),"string"==typeof n&&(c.fileSaveAsSelectedPluginId=n);const l=await i.providers["native-api"](),d=await l.fileAPI();if(r&&r.length>0){const e=[];r.forEach((t=>{e.push(t.getProxyId())})),d.setFileAncestor(e,0)}d.setSelectedFilesData(c)}async FindFileWithName(e,t){if(e&&t&&t instanceof ConnectorPaginatedFileListProvider_ConnectorFolderInfo)return e=this.SanitizeFileName(e),this.GetExistingFileInFolder(e,t)}SanitizeFileName(e){if(""===e)return e;let t=e.normalize("NFC");const s=a.Z.getExtension(t),i=this.mAllowedFileExtns;return i&&i.size>0&&(s&&i.has(s.toLowerCase())||(t+=[...i][0])),t}GetExistingFileInFolder(e,t){const s=t.name;if(!(s in this.mFileListCache))return;const i=e.toLowerCase(),a=this.mFileListCache[s].get({column:"name",direction:"ascending"});let n;return a&&a.some((e=>{const t=e.members.find((e=>e.type!==o.h.FOLDER&&e.name.toLowerCase()===i));return!!t&&(n=t,!0)})),n||void 0}async CreateFolder(e,t){return console.error("Operation not supported."),{}}async FetchFileListDataForFolder(e,t,s){const i=await r.default.getInstance(),o=await i.connectorsAPI(),a=e,n=await o.getFilesForFolder(this.accountId,a.getProxy(),t,this.connectorName,s);return{fileListPage:n.data.folderItems,hasNextPage:n.data.hasNextPage}}async GetRootFolderFromCache(){}async GetFileListFromCache(e,t){}async ParseFilesData(e){const t=[];for(const s of e){let e=!0;let i;if("folder"===s.object_type._value)i=new ConnectorPaginatedFileListProvider_ConnectorFolderInfo({proxy:s}),i.createContext(),i.setName(i.get("name"));else{i=new ConnectorPaginatedFileListProvider_ConnectorFileInfo({proxy:s}),i.createContext();const t=i.get("name");e=this.ShouldShowFile(t),e&&(i.setName(t),this.SetFileProperties(i))}e&&(i.setId(i.getProxy()._id.toString()),t.push(i))}return t}ShouldShowFile(e){const t=a.Z.getExtension(e);return!!t&&!(this.mAllowedFileExtns&&!this.mAllowedFileExtns.has(t))}SetFileProperties(e){e.setModifiedDate(new Date(e.get("modified")));let t=o.h.OTHER;const s=e.get("content_type");if(s)t=a.Z.getAssetTypeFromMimeType(s);else{let s=e.get("ext");s||(s=a.Z.getExtension(e.get("name"))),s&&(t=a.Z.getAssetTypeForFileExt(s))}e.setType(t),e.setSize(e.get("size"))}async GetBreadcrumbsForCurrentFSD(){const e=await r.default.getInstance(),t=await e.fileAPI(),s=await t.getFileAncestors(),i=[];return void 0!==s&&s.length>0&&s.forEach(((e,t)=>{const s=new ConnectorPaginatedFileListProvider_ConnectorFolderInfo({proxy:e});s.createContext(),0===t?s.setName("/"):s.setName(s.get("name")),i.push(s)})),i}async ValidateAssetName(e){const t=await r.default.getInstance(),s=await t.connectorsAPI();try{const t=await s.isFileNameValid(this.connectorName,e);return!(!t.data||!0!==t.data)}catch(e){return!1}}}class ConnectorsProvider{constructor(){this.keySep="|"}ready(){return this.connectors?Promise.resolve(this):this.initProvider().then((()=>Promise.resolve(this)))}async initProvider(){this.connectors=new Map;const e=await r.default.getInstance(),t=await e.connectorsAPI(),s=(await t.getSystemFoldersData(!1,!1)).systemFolderData.connectors,i=await t.isOnedrivePaginationCallsEnabled();return s.forEach((e=>{this.addToConnectorMap(e.name,e.id,i)})),this}getKeyFromConnectorInfo(e,t){return e.concat(this.keySep,t)}addToConnectorMap(e,t,s){let i;i="root"===e?new DCFileListProvider:!s||"onedrive"!==e&&"onedrivebusiness"!==e?new ConnectorFilesProvider(e,t):new ConnectorPaginatedFilesProvider(e,t);const o=this.getKeyFromConnectorInfo(e,t);this.connectors.set(o,i)}getConnector(e,t){var s;const i=this.getKeyFromConnectorInfo(e,t);return null===(s=this.connectors)||void 0===s?void 0:s.get(i)}async addConnector(e,t){const s=await r.default.getInstance(),i=await s.connectorsAPI(),o=await i.isOnedrivePaginationCallsEnabled();this.addToConnectorMap(e,t,o)}}ConnectorsProvider.getInstance=i.providerUtil.getSingletonFunction(ConnectorsProvider)}}]);
//# sourceMappingURL=private/connectors.4e99f1247aedee8a7b15.map